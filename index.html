<!DOCTYPE html>
<html>

<head>
</head>

<body>
    <canvas width="64" height="64" id="game" style="background-color: black;"></canvas>
</body>
<script src="https://cdn.jsdelivr.net/npm/kontra@7.1.3/kontra.min.js"></script>
<script>
    let { GameLoop, Sprite, bindKeys, collides, init, initKeys, keyPressed, randInt, TileEngine } = kontra;

    let { canvas } = init();

    let sprite = Sprite({
        x: 0,        // starting x,y position of the sprite
        y: 0,
        color: 'red',  // fill color of the sprite rectangle
        width: 16,     // width and height of the sprite rectangle
        height: 16,
        //dx: 16          // move the sprite 2px to the right every frame
    });

    let img = new Image();
    img.src = 'assets/tilesheet.png';
    img.onload = function () {
        let tileEngine = TileEngine({
            // tile size
            tilewidth: 16,
            tileheight: 16,

            // map size in tiles
            width: 4,
            height: 4,

            // tileset object
            tilesets: [{
                firstgid: 1,
                image: img
            }],

            // layer object
            layers: [{
                name: 'ground',
                data: [
                    1, 1, 1, 1,
                    1, 2, 2, 1,
                    1, 2, 2, 1,
                    1, 1, 1, 1
                ]
            },
            {
                name: 'collision',
                data: [
                    0, 0, 0, 0,
                    0, 1, 1, 0,
                    0, 1, 1, 0,
                    0, 0, 0, 0
                ]
            }]
        });

        tileEngine.addObject(sprite);


        let loop = GameLoop({  // create the main game loop
            update: function () { // update the game state

                if (keyPressed('left')) {
                    sprite.x = sprite.x - 1;
                    if (tileEngine.layerCollidesWith('collision', sprite)) {
                        sprite.x = sprite.x + 1;
                    }
                }

                if (keyPressed('right')) {
                    sprite.x = sprite.x + 1;
                    if (tileEngine.layerCollidesWith('collision', sprite)) {
                        sprite.x = sprite.x - 1;
                    }
                }

                if (keyPressed('up')) {
                    sprite.y = sprite.y - 1;
                    if (tileEngine.layerCollidesWith('collision', sprite)) {
                        sprite.y = sprite.y + 1;
                    }
                }

                if (keyPressed('down')) {
                    sprite.y = sprite.y + 1;
                    if (tileEngine.layerCollidesWith('collision', sprite)) {
                        sprite.y = sprite.y - 1;
                    }
                }
                //sprite.update();

            },
            render: () => { // render the game state
                tileEngine.renderLayer("ground");
                sprite.render();
            }
        });
        initKeys();

        loop.start();    // start the game

    }


</script>

</html>